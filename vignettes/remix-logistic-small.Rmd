---
title: "Remix in a Small Logistic Regression Example"
author: "Marc Box"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
bibliography: "references.bib"
vignette: >
  %\VignetteIndexEntry{Remix in a Small Logistic Regression Example}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# Remix in a Small Logistic Regression Example

In this vignette we reproduce the logistic regression example from Scott et al 
2016 with a small, artificial data set. The data are stored as package data.

```{r}
data(scott_logistic)
```

The data now loaded are in the binary outcome format, i.e. each observation 
(row) contains an outcome $y$ that can be 1 or 0, and discrete predictors $x_1$ 
to $x_5$. We can compress these data without losing any information by grouping 
the predictor variables and counting the number of positive outcomes in each 
group. The number of binary observations in each group is used to weight each 
count observation in a logistic regression. This is the format used in Scott et 
al 2016, and makes logistic regression far more computationally efficient.

```{r}
scott_logistic.grouped <- aggregate(y ~ x1 + x2 + x3 + x4 + x5, data = scott_logistic, FUN = sum)
# Add weights.
scott_logistic.grouped$w <- aggregate(rep(1, nrow(scott_logistic)), by = scott_logistic[,2:ncol(scott_logistic)], FUN = sum)$x
# Add outcome (proportion).
scott_logistic.grouped$p <- scott_logistic.grouped$y / scott_logistic.grouped$w
```

In the normal data experiments we were able to measure accuracy from the true 
posterior statistics (mean and covariance). In logistic regression the true 
posterior is unknown and can only be approximated (here using MCMC).

We will therefore measure accuracy from the "vanilla" ($M = 1$) MCMC estimates.

### Sample from full posterior

```{r}
H <- 250000

params <- list()
params$mu <- rep(0, 5)
params$Sigma <- 2.5 ^ 2 * diag(5)

out <- logistic.sampler(
  y = scott_logistic.grouped$p,
  x = scott_logistic.grouped[,c("x1", "x2", "x3", "x4", "x5")],
  weights = scott_logistic.grouped$w,
  H = H,
  params = params
)

samples.full <- out$samples
```


